 Done in 195ms
No config path provided, using default 'drizzle.config.ts'
Reading config file '/opt/render/project/src/drizzle.config.ts'
Using 'pg' driver for database querying
[â£·] Pulling schema from database...
Error: getaddrinfo ENOTFOUND base
    at /opt/render/project/src/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Object.query (/opt/render/project/src/node_modules/drizzle-kit/bin.cjs:80622:26)
    at async fromDatabase2 (/opt/render/project/src/node_modules/drizzle-kit/bin.cjs:19276:25) {
  errno: -3008,
  code: 'ENOTFOUND',
  syscall: 'getaddrinfo',
  hostname: 'base'
}
==> Uploading build...
==> Uploaded in 6.9s. Compression took 3.7s
==> Build successful ðŸŽ‰
==> Setting WEB_CONCURRENCY=1 by default, based on available CPUs in the instance
==> Deploying...
==> Running 'npm run start'
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/opt/render/project/src/dist/index.cjs:83
${Iu(t)}`);return{...F,id:I,type:B,function:{...te,name:Z,arguments:W}}})}}:{...f,message:{...A,content:h,role:S,refusal:c.refusal??null},finish_reason:u,index:p,logprobs:d}}),created:i,model:a,object:"chat.completion",...s?{system_fingerprint:s}:{}};return Y4(l,e)}function Iu(t){return JSON.stringify(t)}var nc=class t extends Kn{static fromReadableStream(e){let r=new t(null);return r._run(()=>r._fromReadableStream(e)),r}static runTools(e,r,n){let i=new t(r),a={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,r,a)),i}};var _r=class extends E{constructor(){super(...arguments),this.messages=new Wn(this._client)}create(e,r){return this._client.post("/chat/completions",{body:e,...r,stream:e.stream??!1})}retrieve(e,r){return this._client.get(w`/chat/completions/${e}`,r)}update(e,r,n){return this._client.post(w`/chat/completions/${e}`,{body:r,...n})}list(e={},r){return this._client.getAPIList("/chat/completions",K,{query:e,...r})}delete(e,r){return this._client.delete(w`/chat/completions/${e}`,r)}parse(e,r){return rE(e.tools),this._client.chat.completions.create(e,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(n=>Xo(n,e))}runTools(e,r){return e.stream?nc.runTools(this._client,e,r):rc.runTools(this._client,e,r)}stream(e,r){return Kn.createChatCompletion(this._client,e,r)}};_r.Messages=Wn;var Xr=class extends E{constructor(){super(...arguments),this.completions=new _r(this._client)}};Xr.Completions=_r;var cE=Symbol("brand.privateNullableHeaders");function*Fj(t){if(!t)return;if(cE in t){let{values:n,nulls:i}=t;yield*n.entries();for(let a of i)yield[a,null];return}let e=!1,r;t instanceof Headers?r=t.entries():eg(t)?r=t:(e=!0,r=Object.entries(t??{}));for(let n of r){let i=n[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");let a=eg(n[1])?n[1]:[n[1]],s=!1;for(let o of a)o!==void 0&&(e&&!s&&(s=!0,yield[i,null]),yield[i,o])}}var T=t=>{let e=new Headers,r=new Set;for(let n of t){let i=new Set;for(let[a,s]of Fj(n)){let o=a.toLowerCase();i.has(o)||(e.delete(a),i.add(o)),s===null?(e.delete(a),r.add(o)):(e.append(a,s),r.delete(o))}}return{[cE]:!0,values:e,nulls:r}};var qa=class extends E{create(e,r){return this._client.post("/audio/speech",{body:e,...r,headers:T([{Accept:"application/octet-stream"},r?.headers]),__binaryResponse:!0})}};var ja=class extends E{create(e,r){return this._client.post("/audio/transcriptions",wt({body:e,...r,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}};var $a=class extends E{create(e,r){return this._client.post("/audio/translations",wt({body:e,...r,__metadata:{model:e.model}},this._client))}};var ar=class extends E{constructor(){super(...arguments),this.transcriptions=new ja(this._client),this.translations=new $a(this._client),this.speech=new qa(this._client)}};ar.Transcriptions=ja;ar.Translations=$a;ar.Speech=qa;var Jn=class extends E{create(e,r){return this._client.post("/batches",{body:e,...r})}retrieve(e,r){return this._client.get(w`/batches/${e}`,r)}list(e={},r){return this._client.getAPIList("/batches",K,{query:e,...r})}cancel(e,r){return this._client.post(w`/batches/${e}/cancel`,r)}};var Ma=class extends E{create(e,r){return this._client.post("/assistants",{body:e,...r,headers:T([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,r){return this._client.get(w`/assistants/${e}`,{...r,headers:T([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,r,n){return this._client.post(w`/assistants/${e}`,{body:r,...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},r){return this._client.getAPIList("/assistants",K,{query:e,...r,headers:T([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,r){return this._client.delete(w`/assistants/${e}`,{...r,headers:T([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var Fa=class extends E{create(e,r){return this._client.post("/realtime/sessions",{body:e,...r,headers:T([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var Da=class extends E{create(e,r){return this._client.post("/realtime/transcription_sessions",{body:e,...r,headers:T([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var Zr=class extends E{constructor(){super(...arguments),this.sessions=new Fa(this._client),this.transcriptionSessions=new Da(this._client)}};Zr.Sessions=Fa;Zr.TranscriptionSessions=Da;var La=class extends E{create(e,r){return this._client.post("/chatkit/sessions",{body:e,...r,headers:T([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}cancel(e,r){return this._client.post(w`/chatkit/sessions/${e}/cancel`,{...r,headers:T([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}};var Ba=class extends E{retrieve(e,r){return this._client.get(w`/chatkit/threads/${e}`,{...r,headers:T([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}list(e={},r){return this._client.getAPIList("/chatkit/threads",xr,{query:e,...r,headers:T([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}delete(e,r){return this._client.delete(w`/chatkit/threads/${e}`,{...r,headers:T([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}listItems(e,r={},n){return this._client.getAPIList(w`/chatkit/threads/${e}/items`,xr,{query:r,...n,headers:T([{"OpenAI-Beta":"chatkit_beta=v1"},n?.headers])})}};var Yr=class extends E{constructor(){super(...arguments),this.sessions=new La(this._client),this.threads=new Ba(this._client)}};Yr.Sessions=La;Yr.Threads=Ba;var za=class extends E{create(e,r,n){return this._client.post(w`/threads/${e}/messages`,{body:r,...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,r,n){let{thread_id:i}=r;return this._client.get(w`/threads/${i}/messages/${e}`,{...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,r,n){let{thread_id:i,...a}=r;return this._client.post(w`/threads/${i}/messages/${e}`,{body:a,...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r={},n){return this._client.getAPIList(w`/threads/${e}/messages`,K,{query:r,...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,r,n){let{thread_id:i}=r;return this._client.delete(w`/threads/${i}/messages/${e}`,{...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};var Ua=class extends E{retrieve(e,r,n){let{thread_id:i,run_id:a,...s}=r;return this._client.get(w`/threads/${i}/runs/${a}/steps/${e}`,{query:s,...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r,n){let{thread_id:i,...a}=r;return this._client.getAPIList(w`/threads/${i}/runs/${e}/steps`,K,{query:a,...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};var lE=t=>{if(typeof Buffer<"u"){let e=Buffer.from(t,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(t),r=e.length,n=new Uint8Array(r);for(let i=0;i<r;i++)n[i]=e.charCodeAt(i);return Array.from(new Float32Array(n.buffer))}};var en=t=>{if(typeof globalThis.process<"u")return globalThis.process.env?.[t]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(t)?.trim()};var He,Zn,qg,sr,Ou,Ft,Yn,Qa,Xn,qu,_t,Nu,Ru,sc,ic,ac,uE,pE,dE,fE,mE,hE,gE,Sr=class extends Kr{constructor(){super(...arguments),He.add(this),qg.set(this,[]),sr.set(this,{}),Ou.set(this,{}),Ft.set(this,void 0),Yn.set(this,void 0),Qa.set(this,void 0),Xn.set(this,void 0),qu.set(this,void 0),_t.set(this,void 0),Nu.set(this,void 0),Ru.set(this,void 0),sc.set(this,void 0)}[(qg=new WeakMap,sr=new WeakMap,Ou=new WeakMap,Ft=new WeakMap,Yn=new WeakMap,Qa=new WeakMap,Xn=new WeakMap,qu=new WeakMap,_t=new WeakMap,Nu=new WeakMap,Ru=new WeakMap,sc=new WeakMap,He=new WeakSet,Symbol.asyncIterator)](){let e=[],r=[],n=!1;return this.on("event",i=>{let a=r.shift();a?a.resolve(i):e.push(i)}),this.on("end",()=>{n=!0;for(let i of r)i.resolve(void 0);r.length=0}),this.on("abort",i=>{n=!0;for(let a of r)a.reject(i);r.length=0}),this.on("error",i=>{n=!0;for(let a of r)a.reject(i);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,s)=>r.push({resolve:a,reject:s})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let r=new Zn;return r._run(()=>r._fromReadableStream(e)),r}async _fromReadableStream(e,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();let i=nr.fromReadableStream(e,this.controller);for await(let a of i)x(this,He,"m",ic).call(this,a);if(i.controller.signal?.aborted)throw new Oe;return this._addRun(x(this,He,"m",ac).call(this))}toReadableStream(){return new nr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,r,n,i){let a=new Zn;return a._run(()=>a._runToolAssistantStream(e,r,n,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,r,n,i){let a=i?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));let s={...n,stream:!0},o=await e.submitToolOutputs(r,s,{...i,signal:this.controller.signal});this._connected();for await(let l of o)x(this,He,"m",ic).call(this,l);if(o.controller.signal?.aborted)throw new Oe;return this._addRun(x(this,He,"m",ac).call(this))}static createThreadAssistantStream(e,r,n){let i=new Zn;return i._run(()=>i._threadAssistantStream(e,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),i}static createAssistantStream(e,r,n,i){let a=new Zn;return a._run(()=>a._runAssistantStream(e,r,n,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return x(this,Nu,"f")}currentRun(){return x(this,Ru,"f")}currentMessageSnapshot(){return x(this,Ft,"f")}currentRunStepSnapshot(){return x(this,sc,"f")}async finalRunSteps(){return await this.done(),Object.values(x(this,sr,"f"))}async finalMessages(){return await this.done(),Object.values(x(this,Ou,"f"))}async finalRun(){if(await this.done(),!x(this,Yn,"f"))throw Error("Final run was not received.");return x(this,Yn,"f")}async _createThreadAssistantStream(e,r,n){let i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let a={...r,stream:!0},s=await e.createAndRun(a,{...n,signal:this.controller.signal});this._connected();for await(let o of s)x(this,He,"m",ic).call(this,o);if(s.controller.signal?.aborted)throw new Oe;return this._addRun(x(this,He,"m",ac).call(this))}async _createAssistantStream(e,r,n,i){let a=i?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));let s={...n,stream:!0},o=await e.create(r,s,{...i,signal:this.controller.signal});this._connected();for await(let l of o)x(this,He,"m",ic).call(this,l);if(o.controller.signal?.aborted)throw new Oe;return this._addRun(x(this,He,"m",ac).call(this))}static accumulateDelta(e,r){for(let[n,i]of Object.entries(r)){if(!e.hasOwnProperty(n)){e[n]=i;continue}let a=e[n];if(a==null){e[n]=i;continue}if(n==="index"||n==="type"){e[n]=i;continue}if(typeof a=="string"&&typeof i=="string")a+=i;else if(typeof a=="number"&&typeof i=="number")a+=i;else if(zo(a)&&zo(i))a=this.accumulateDelta(a,i);else if(Array.isArray(a)&&Array.isArray(i)){if(a.every(s=>typeof s=="string"||typeof s=="number")){a.push(...i);continue}for(let s of i){if(!zo(s))throw new Error(`Expected array delta entry to be an object but got: ${s}`);let o=s.index;if(o==null)throw console.error(s),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);let l=a[o];l==null?a.push(s):a[o]=this.accumulateDelta(l,s)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${i}, accValue: ${a}`);e[n]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,r,n){return await this._createThreadAssistantStream(r,e,n)}async _runAssistantStream(e,r,n,i){return await this._createAssistantStream(r,e,n,i)}async _runToolAssistantStream(e,r,n,i){return await this._createToolAssistantStream(r,e,n,i)}};Zn=Sr,ic=function(e){if(!this.ended)switch(L(this,Nu,e,"f"),x(this,He,"m",dE).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":x(this,He,"m",gE).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":x(this,He,"m",pE).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":x(this,He,"m",uE).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},ac=function(){if(this.ended)throw new q("stream has ended, this shouldn't happen");if(!x(this,Yn,"f"))throw Error("Final run has not been received");return x(this,Yn,"f")},uE=function(e){let[r,n]=x(this,He,"m",mE).call(this,e,x(this,Ft,"f"));L(this,Ft,r,"f"),x(this,Ou,"f")[r.id]=r;for(let i of n){let a=r.content[i.index];a?.type=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,r),e.data.delta.content)for(let i of e.data.delta.content){if(i.type=="text"&&i.text){let a=i.text,s=r.content[i.index];if(s&&s.type=="text")this._emit("textDelta",a,s.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(i.index!=x(this,Qa,"f")){if(x(this,Xn,"f"))switch(x(this,Xn,"f").type){case"text":this._emit("textDone",x(this,Xn,"f").text,x(this,Ft,"f"));break;case"image_file":this._emit("imageFileDone",x(this,Xn,"f").image_file,x(this,Ft,"f"));break}L(this,Qa,i.index,"f")}L(this,Xn,r.content[i.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(x(this,Qa,"f")!==void 0){let i=e.data.content[x(this,Qa,"f")];if(i)switch(i.type){case"image_file":this._emit("imageFileDone",i.image_file,x(this,Ft,"f"));break;case"text":this._emit("textDone",i.text,x(this,Ft,"f"));break}}x(this,Ft,"f")&&this._emit("messageDone",e.data),L(this,Ft,void 0,"f")}},pE=function(e){let r=x(this,He,"m",fE).call(this,e);switch(L(this,sc,r,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&r.step_details.type=="tool_calls")for(let a of n.step_details.tool_calls)a.index==x(this,qu,"f")?this._emit("toolCallDelta",a,r.step_details.tool_calls[a.index]):(x(this,_t,"f")&&this._emit("toolCallDone",x(this,_t,"f")),L(this,qu,a.index,"f"),L(this,_t,r.step_details.tool_calls[a.index],"f"),x(this,_t,"f")&&this._emit("toolCallCreated",x(this,_t,"f")));this._emit("runStepDelta",e.data.delta,r);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":L(this,sc,void 0,"f"),e.data.step_details.type=="tool_calls"&&x(this,_t,"f")&&(this._emit("toolCallDone",x(this,_t,"f")),L(this,_t,void 0,"f")),this._emit("runStepDone",e.data,r);break;case"thread.run.step.in_progress":break}},dE=function(e){x(this,qg,"f").push(e),this._emit("event",e)},fE=function(e){switch(e.event){case"thread.run.step.created":return x(this,sr,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let r=x(this,sr,"f")[e.data.id];if(!r)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){let i=Zn.accumulateDelta(r,n.delta);x(this,sr,"f")[e.data.id]=i}return x(this,sr,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":x(this,sr,"f")[e.data.id]=e.data;break}if(x(this,sr,"f")[e.data.id])return x(this,sr,"f")[e.data.id];throw new Error("No snapshot available")},mE=function(e,r){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!r)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=e.data;if(i.delta.content)for(let a of i.delta.content)if(a.index in r.content){let s=r.content[a.index];r.content[a.index]=x(this,He,"m",hE).call(this,a,s)}else r.content[a.index]=a,n.push(a);return[r,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(r)return[r,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},hE=function(e,r){return Zn.accumulateDelta(r,e)},gE=function(e){switch(L(this,Ru,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":L(this,Yn,e.data,"f"),x(this,_t,"f")&&(this._emit("toolCallDone",x(this,_t,"f")),L(this,_t,void 0,"f"));break;case"thread.run.cancelling":break}};var ei=class extends E{constructor(){super(...arguments),this.steps=new Ua(this._client)}create(e,r,n){let{include:i,...a}=r;return this._client.post(w`/threads/${e}/runs`,{query:{include:i},body:a,...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:r.stream??!1})}retrieve(e,r,n){let{thread_id:i}=r;return this._client.get(w`/threads/${i}/runs/${e}`,{...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,r,n){let{thread_id:i,...a}=r;return this._client.post(w`/threads/${i}/runs/${e}`,{body:a,...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r={},n){return this._client.getAPIList(w`/threads/${e}/runs`,K,{query:r,...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,r,n){let{thread_id:i}=r;return this._client.post(w`/threads/${i}/runs/${e}/cancel`,{...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,r,n){let i=await this.create(e,r,n);return await this.poll(i.id,{thread_id:e},n)}createAndStream(e,r,n){return Sr.createAssistantStream(e,this._client.beta.threads.runs,r,n)}async poll(e,r,n){let i=T([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:a,response:s}=await this.retrieve(e,r,{...n,headers:{...n?.headers,...i}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let l=s.headers.get("openai-poll-after-ms");if(l){let c=parseInt(l);isNaN(c)||(o=c)}}await tr(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,r,n){return Sr.createAssistantStream(e,this._client.beta.threads.runs,r,n)}submitToolOutputs(e,r,n){let{thread_id:i,...a}=r;return this._client.post(w`/threads/${i}/runs/${e}/submit_tool_outputs`,{body:a,...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:r.stream??!1})}async submitToolOutputsAndPoll(e,r,n){let i=await this.submitToolOutputs(e,r,n);return await this.poll(i.id,r,n)}submitToolOutputsStream(e,r,n){return Sr.createToolAssistantStream(e,this._client.beta.threads.runs,r,n)}};ei.Steps=Ua;var tn=class extends E{constructor(){super(...arguments),this.runs=new ei(this._client),this.messages=new za(this._client)}create(e={},r){return this._client.post("/threads",{body:e,...r,headers:T([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,r){return this._client.get(w`/threads/${e}`,{...r,headers:T([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,r,n){return this._client.post(w`/threads/${e}`,{body:r,...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,r){return this._client.delete(w`/threads/${e}`,{...r,headers:T([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}createAndRun(e,r){return this._client.post("/threads/runs",{body:e,...r,headers:T([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,r){let n=await this.createAndRun(e,r);return await this.runs.poll(n.id,{thread_id:n.thread_id},r)}createAndRunStream(e,r){return Sr.createThreadAssistantStream(e,this._client.beta.threads,r)}};tn.Runs=ei;tn.Messages=za;var Dt=class extends E{constructor(){super(...arguments),this.realtime=new Zr(this._client),this.chatkit=new Yr(this._client),this.assistants=new Ma(this._client),this.threads=new tn(this._client)}};Dt.Realtime=Zr;Dt.ChatKit=Yr;Dt.Assistants=Ma;Dt.Threads=tn;var ti=class extends E{create(e,r){return this._client.post("/completions",{body:e,...r,stream:e.stream??!1})}};var Ha=class extends E{retrieve(e,r,n){let{container_id:i}=r;return this._client.get(w`/containers/${i}/files/${e}/content`,{...n,headers:T([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}};var ri=class extends E{constructor(){super(...arguments),this.content=new Ha(this._client)}create(e,r,n){return this._client.post(w`/containers/${e}/files`,wt({body:r,...n},this._client))}retrieve(e,r,n){let{container_id:i}=r;return this._client.get(w`/containers/${i}/files/${e}`,n)}list(e,r={},n){return this._client.getAPIList(w`/containers/${e}/files`,K,{query:r,...n})}delete(e,r,n){let{container_id:i}=r;return this._client.delete(w`/containers/${i}/files/${e}`,{...n,headers:T([{Accept:"*/*"},n?.headers])})}};ri.Content=Ha;var rn=class extends E{constructor(){super(...arguments),this.files=new ri(this._client)}create(e,r){return this._client.post("/containers",{body:e,...r})}retrieve(e,r){return this._client.get(w`/containers/${e}`,r)}list(e={},r){return this._client.getAPIList("/containers",K,{query:e,...r})}delete(e,r){return this._client.delete(w`/containers/${e}`,{...r,headers:T([{Accept:"*/*"},r?.headers])})}};rn.Files=ri;var Va=class extends E{create(e,r,n){let{include:i,...a}=r;return this._client.post(w`/conversations/${e}/items`,{query:{include:i},body:a,...n})}retrieve(e,r,n){let{conversation_id:i,...a}=r;return this._client.get(w`/conversations/${i}/items/${e}`,{query:a,...n})}list(e,r={},n){return this._client.getAPIList(w`/conversations/${e}/items`,xr,{query:r,...n})}delete(e,r,n){let{conversation_id:i}=r;return this._client.delete(w`/conversations/${i}/items/${e}`,n)}};var nn=class extends E{constructor(){super(...arguments),this.items=new Va(this._client)}create(e={},r){return this._client.post("/conversations",{body:e,...r})}retrieve(e,r){return this._client.get(w`/conversations/${e}`,r)}update(e,r,n){return this._client.post(w`/conversations/${e}`,{body:r,...n})}delete(e,r){return this._client.delete(w`/conversations/${e}`,r)}};nn.Items=Va;var ni=class extends E{create(e,r){let n=!!e.encoding_format,i=n?e.encoding_format:"base64";n&&Ce(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let a=this._client.post("/embeddings",{body:{...e,encoding_format:i},...r});return n?a:(Ce(this._client).debug("embeddings/decoding base64 embeddings from base64"),a._thenUnwrap(s=>(s&&s.data&&s.data.forEach(o=>{let l=o.embedding;o.embedding=lE(l)}),s)))}};var Wa=class extends E{retrieve(e,r,n){let{eval_id:i,run_id:a}=r;return this._client.get(w`/evals/${i}/runs/${a}/output_items/${e}`,n)}list(e,r,n){let{eval_id:i,...a}=r;return this._client.getAPIList(w`/evals/${i}/runs/${e}/output_items`,K,{query:a,...n})}};var ii=class extends E{constructor(){super(...arguments),this.outputItems=new Wa(this._client)}create(e,r,n){return this._client.post(w`/evals/${e}/runs`,{body:r,...n})}retrieve(e,r,n){let{eval_id:i}=r;return this._client.get(w`/evals/${i}/runs/${e}`,n)}list(e,r={},n){return this._client.getAPIList(w`/evals/${e}/runs`,K,{query:r,...n})}delete(e,r,n){let{eval_id:i}=r;return this._client.delete(w`/evals/${i}/runs/${e}`,n)}cancel(e,r,n){let{eval_id:i}=r;return this._client.post(w`/evals/${i}/runs/${e}`,n)}};ii.OutputItems=Wa;var an=class extends E{constructor(){super(...arguments),this.runs=new ii(this._client)}create(e,r){return this._client.post("/evals",{body:e,...r})}retrieve(e,r){return this._client.get(w`/evals/${e}`,r)}update(e,r,n){return this._client.post(w`/evals/${e}`,{body:r,...n})}list(e={},r){return this._client.getAPIList("/evals",K,{query:e,...r})}delete(e,r){return this._client.delete(w`/evals/${e}`,r)}};an.Runs=ii;var ai=class extends E{create(e,r){return this._client.post("/files",wt({body:e,...r},this._client))}retrieve(e,r){return this._client.get(w`/files/${e}`,r)}list(e={},r){return this._client.getAPIList("/files",K,{query:e,...r})}delete(e,r){return this._client.delete(w`/files/${e}`,r)}content(e,r){return this._client.get(w`/files/${e}/content`,{...r,headers:T([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:r=5e3,maxWait:n=1800*1e3}={}){let i=new Set(["processed","error","deleted"]),a=Date.now(),s=await this.retrieve(e);for(;!s.status||!i.has(s.status);)if(await tr(r),s=await this.retrieve(e),Date.now()-a>n)throw new Wr({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return s}};var Ga=class extends E{};var Ka=class extends E{run(e,r){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...r})}validate(e,r){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...r})}};var si=class extends E{constructor(){super(...arguments),this.graders=new Ka(this._client)}};si.Graders=Ka;var Ja=class extends E{create(e,r,n){return this._client.getAPIList(w`/fine_tuning/checkpoints/${e}/permissions`,ir,{body:r,method:"post",...n})}retrieve(e,r={},n){return this._client.get(w`/fine_tuning/checkpoints/${e}/permissions`,{query:r,...n})}delete(e,r,n){let{fine_tuned_model_checkpoint:i}=r;return this._client.delete(w`/fine_tuning/checkpoints/${i}/permissions/${e}`,n)}};var oi=class extends E{constructor(){super(...arguments),this.permissions=new Ja(this._client)}};oi.Permissions=Ja;var Xa=class extends E{list(e,r={},n){return this._client.getAPIList(w`/fine_tuning/jobs/${e}/checkpoints`,K,{query:r,...n})}};var ci=class extends E{constructor(){super(...arguments),this.checkpoints=new Xa(this._client)}create(e,r){return this._client.post("/fine_tuning/jobs",{body:e,...r})}retrieve(e,r){return this._client.get(w`/fine_tuning/jobs/${e}`,r)}list(e={},r){return this._client.getAPIList("/fine_tuning/jobs",K,{query:e,...r})}cancel(e,r){return this._client.post(w`/fine_tuning/jobs/${e}/cancel`,r)}listEvents(e,r={},n){return this._client.getAPIList(w`/fine_tuning/jobs/${e}/events`,K,{query:r,...n})}pause(e,r){return this._client.post(w`/fine_tuning/jobs/${e}/pause`,r)}resume(e,r){return this._client.post(w`/fine_tuning/jobs/${e}/resume`,r)}};ci.Checkpoints=Xa;var Lt=class extends E{constructor(){super(...arguments),this.methods=new Ga(this._client),this.jobs=new ci(this._client),this.checkpoints=new oi(this._client),this.alpha=new si(this._client)}};Lt.Methods=Ga;Lt.Jobs=ci;Lt.Checkpoints=oi;Lt.Alpha=si;var Za=class extends E{};var sn=class extends E{constructor(){super(...arguments),this.graderModels=new Za(this._client)}};sn.GraderModels=Za;var li=class extends E{createVariation(e,r){return this._client.post("/images/variations",wt({body:e,...r},this._client))}edit(e,r){return this._client.post("/images/edits",wt({body:e,...r,stream:e.stream??!1},this._client))}generate(e,r){return this._client.post("/images/generations",{body:e,...r,stream:e.stream??!1})}};var ui=class extends E{retrieve(e,r){return this._client.get(w`/models/${e}`,r)}list(e){return this._client.getAPIList("/models",ir,e)}delete(e,r){return this._client.delete(w`/models/${e}`,r)}};var pi=class extends E{create(e,r){return this._client.post("/moderations",{body:e,...r})}};var Ya=class extends E{accept(e,r,n){return this._client.post(w`/realtime/calls/${e}/accept`,{body:r,...n,headers:T([{Accept:"*/*"},n?.headers])})}hangup(e,r){return this._client.post(w`/realtime/calls/${e}/hangup`,{...r,headers:T([{Accept:"*/*"},r?.headers])})}refer(e,r,n){return this._client.post(w`/realtime/calls/${e}/refer`,{body:r,...n,headers:T([{Accept:"*/*"},n?.headers])})}reject(e,r={},n){return this._client.post(w`/realtime/calls/${e}/reject`,{body:r,...n,headers:T([{Accept:"*/*"},n?.headers])})}};var es=class extends E{create(e,r){return this._client.post("/realtime/client_secrets",{body:e,...r})}};var Er=class extends E{constructor(){super(...arguments),this.clientSecrets=new es(this._client),this.calls=new Ya(this._client)}};Er.ClientSecrets=es;Er.Calls=Ya;function vE(t,e){return!e||!h$(e)?{...t,output_parsed:null,output:t.output.map(r=>r.type==="function_call"?{...r,parsed_arguments:null}:r.type==="message"?{...r,content:r.content.map(n=>({...n,parsed:null}))}:r)}:jg(t,e)}function jg(t,e){let r=t.output.map(i=>{if(i.type==="function_call")return{...i,parsed_arguments:y$(e,i)};if(i.type==="message"){let a=i.content.map(s=>s.type==="output_text"?{...s,parsed:m$(e,s.text)}:s);return{...i,content:a}}return i}),n=Object.assign({},t,{output:r});return Object.getOwnPropertyDescriptor(t,"output_text")||ju(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let i of n.output)if(i.type==="message"){for(let a of i.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),n}function m$(t,e){return t.text?.format?.type!=="json_schema"?null:"$parseRaw"in t.text?.format?(t.text?.format).$parseRaw(e):JSON.parse(e)}function h$(t){return!!Jo(t.text?.format)}function g$(t){return t?.$brand==="auto-parseable-tool"}function v$(t,e){return t.find(r=>r.type==="function"&&r.name===e)}function y$(t,e){let r=v$(t.tools??[],e.name);return{...e,...e,parsed_arguments:g$(r)?r.$parseRaw(e.arguments):r?.strict?JSON.parse(e.arguments):null}}function ju(t){let e=[];for(let r of t.output)if(r.type==="message")for(let n of r.content)n.type==="output_text"&&e.push(n.text);t.output_text=e.join("")}var ts,$u,on,Mu,yE,xE,bE,wE,Fu=class t extends Kr{constructor(e){super(),ts.add(this),$u.set(this,void 0),on.set(this,void 0),Mu.set(this,void 0),L(this,$u,e,"f")}static createResponse(e,r,n){let i=new t(r);return i._run(()=>i._createOrRetrieveResponse(e,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createOrRetrieveResponse(e,r,n){let i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),x(this,ts,"m",yE).call(this);let a,s=null;"response_id"in r?(a=await e.responses.retrieve(r.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),s=r.starting_after??null):a=await e.responses.create({...r,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(let o of a)x(this,ts,"m",xE).call(this,o,s);if(a.controller.signal?.aborted)throw new Oe;return x(this,ts,"m",bE).call(this)}[($u=new WeakMap,on=new WeakMap,Mu=new WeakMap,ts=new WeakSet,yE=function(){this.ended||L(this,on,void 0,"f")},xE=function(r,n){if(this.ended)return;let i=(s,o)=>{(n==null||o.sequence_number>n)&&this._emit(s,o)},a=x(this,ts,"m",wE).call(this,r);switch(i("event",r),r.type){case"response.output_text.delta":{let s=a.output[r.output_index];if(!s)throw new q(`missing output at index ${r.output_index}`);if(s.type==="message"){let o=s.content[r.content_index];if(!o)throw new q(`missing content at index ${r.content_index}`);if(o.type!=="output_text")throw new q(`expected content to be 'output_text', got ${o.type}`);i("response.output_text.delta",{...r,snapshot:o.text})}break}case"response.function_call_arguments.delta":{let s=a.output[r.output_index];if(!s)throw new q(`missing output at index ${r.output_index}`);s.type==="function_call"&&i("response.function_call_arguments.delta",{...r,snapshot:s.arguments});break}default:i(r.type,r);break}},bE=function(){if(this.ended)throw new q("stream has ended, this shouldn't happen");let r=x(this,on,"f");if(!r)throw new q("request ended without sending any events");L(this,on,void 0,"f");let n=x$(r,x(this,$u,"f"));return L(this,Mu,n,"f"),n},wE=function(r){let n=x(this,on,"f");if(!n){if(r.type!=="response.created")throw new q(`When snapshot hasn't been set yet, expected 'response.created' event, got ${r.type}`);return n=L(this,on,r.response,"f"),n}switch(r.type){case"response.output_item.added":{n.output.push(r.item);break}case"response.content_part.added":{let i=n.output[r.output_index];if(!i)throw new q(`missing output at index ${r.output_index}`);let a=i.type,s=r.part;a==="message"&&s.type!=="reasoning_text"?i.content.push(s):a==="reasoning"&&s.type==="reasoning_text"&&(i.content||(i.content=[]),i.content.push(s));break}case"response.output_text.delta":{let i=n.output[r.output_index];if(!i)throw new q(`missing output at index ${r.output_index}`);if(i.type==="message"){let a=i.content[r.content_index];if(!a)throw new q(`missing content at index ${r.content_index}`);if(a.type!=="output_text")throw new q(`expected content to be 'output_text', got ${a.type}`);a.text+=r.delta}break}case"response.function_call_arguments.delta":{let i=n.output[r.output_index];if(!i)throw new q(`missing output at index ${r.output_index}`);i.type==="function_call"&&(i.arguments+=r.delta);break}case"response.reasoning_text.delta":{let i=n.output[r.output_index];if(!i)throw new q(`missing output at index ${r.output_index}`);if(i.type==="reasoning"){let a=i.content?.[r.content_index];if(!a)throw new q(`missing content at index ${r.content_index}`);if(a.type!=="reasoning_text")throw new q(`expected content to be 'reasoning_text', got ${a.type}`);a.text+=r.delta}break}case"response.completed":{L(this,on,r.response,"f");break}}return n},Symbol.asyncIterator)](){let e=[],r=[],n=!1;return this.on("event",i=>{let a=r.shift();a?a.resolve(i):e.push(i)}),this.on("end",()=>{n=!0;for(let i of r)i.resolve(void 0);r.length=0}),this.on("abort",i=>{n=!0;for(let a of r)a.reject(i);r.length=0}),this.on("error",i=>{n=!0;for(let a of r)a.reject(i);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,s)=>r.push({resolve:a,reject:s})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=x(this,Mu,"f");if(!e)throw new q("stream ended without producing a ChatCompletion");return e}};function x$(t,e){return vE(t,e)}var rs=class extends E{list(e,r={},n){return this._client.getAPIList(w`/responses/${e}/input_items`,K,{query:r,...n})}};var ns=class extends E{count(e={},r){return this._client.post("/responses/input_tokens",{body:e,...r})}};var Ar=class extends E{constructor(){super(...arguments),this.inputItems=new rs(this._client),this.inputTokens=new ns(this._client)}create(e,r){return this._client.post("/responses",{body:e,...r,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&ju(n),n))}retrieve(e,r={},n){return this._client.get(w`/responses/${e}`,{query:r,...n,stream:r?.stream??!1})._thenUnwrap(i=>("object"in i&&i.object==="response"&&ju(i),i))}delete(e,r){return this._client.delete(w`/responses/${e}`,{...r,headers:T([{Accept:"*/*"},r?.headers])})}parse(e,r){return this._client.responses.create(e,r)._thenUnwrap(n=>jg(n,e))}stream(e,r){return Fu.createResponse(this._client,e,r)}cancel(e,r){return this._client.post(w`/responses/${e}/cancel`,r)}compact(e,r){return this._client.post("/responses/compact",{body:e,...r})}};Ar.InputItems=rs;Ar.InputTokens=ns;var is=class extends E{create(e,r,n){return this._client.post(w`/uploads/${e}/parts`,wt({body:r,...n},this._client))}};var cn=class extends E{constructor(){super(...arguments),this.parts=new is(this._client)}create(e,r){return this._client.post("/uploads",{body:e,...r})}cancel(e,r){return this._client.post(w`/uploads/${e}/cancel`,r)}complete(e,r,n){return this._client.post(w`/uploads/${e}/complete`,{body:r,...n})}};cn.Parts=is;var _E=async t=>{let e=await Promise.allSettled(t),r=e.filter(i=>i.status==="rejected");if(r.length){for(let i of r)console.error(i.reason);throw new Error(`${r.length} promise(s) failed - see the above errors`)}let n=[];for(let i of e)i.status==="fulfilled"&&n.push(i.value);return n};var as=class extends E{create(e,r,n){return this._client.post(w`/vector_stores/${e}/file_batches`,{body:r,...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,r,n){let{vector_store_id:i}=r;return this._client.get(w`/vector_stores/${i}/file_batches/${e}`,{...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,r,n){let{vector_store_id:i}=r;return this._client.post(w`/vector_stores/${i}/file_batches/${e}/cancel`,{...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,r,n){let i=await this.create(e,r);return await this.poll(e,i.id,n)}listFiles(e,r,n){let{vector_store_id:i,...a}=r;return this._client.getAPIList(w`/vector_stores/${i}/file_batches/${e}/files`,K,{query:a,...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async poll(e,r,n){let i=T([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:a,response:s}=await this.retrieve(r,{vector_store_id:e},{...n,headers:i}).withResponse();switch(a.status){case"in_progress":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let l=s.headers.get("openai-poll-after-ms");if(l){let c=parseInt(l);isNaN(c)||(o=c)}}await tr(o);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,{files:r,fileIds:n=[]},i){if(r==null||r.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let a=i?.maxConcurrency??5,s=Math.min(a,r.length),o=this._client,l=r.values(),c=[...n];async function u(d){for(let f of d){let h=await o.files.create({file:f,purpose:"assistants"},i);c.push(h.id)}}let p=Array(s).fill(l).map(u);return await _E(p),await this.createAndPoll(e,{file_ids:c})}};var ss=class extends E{create(e,r,n){return this._client.post(w`/vector_stores/${e}/files`,{body:r,...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,r,n){let{vector_store_id:i}=r;return this._client.get(w`/vector_stores/${i}/files/${e}`,{...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,r,n){let{vector_store_id:i,...a}=r;return this._client.post(w`/vector_stores/${i}/files/${e}`,{body:a,...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r={},n){return this._client.getAPIList(w`/vector_stores/${e}/files`,K,{query:r,...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,r,n){let{vector_store_id:i}=r;return this._client.delete(w`/vector_stores/${i}/files/${e}`,{...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,r,n){let i=await this.create(e,r,n);return await this.poll(e,i.id,n)}async poll(e,r,n){let i=T([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let a=await this.retrieve(r,{vector_store_id:e},{...n,headers:i}).withResponse(),s=a.data;switch(s.status){case"in_progress":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let l=a.response.headers.get("openai-poll-after-ms");if(l){let c=parseInt(l);isNaN(c)||(o=c)}}await tr(o);break;case"failed":case"completed":return s}}}async upload(e,r,n){let i=await this._client.files.create({file:r,purpose:"assistants"},n);return this.create(e,{file_id:i.id},n)}async uploadAndPoll(e,r,n){let i=await this.upload(e,r,n);return await this.poll(e,i.id,n)}content(e,r,n){let{vector_store_id:i}=r;return this._client.getAPIList(w`/vector_stores/${i}/files/${e}/content`,ir,{...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};var kr=class extends E{constructor(){super(...arguments),this.files=new ss(this._client),this.fileBatches=new as(this._client)}create(e,r){return this._client.post("/vector_stores",{body:e,...r,headers:T([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,r){return this._client.get(w`/vector_stores/${e}`,{...r,headers:T([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,r,n){return this._client.post(w`/vector_stores/${e}`,{body:r,...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},r){return this._client.getAPIList("/vector_stores",K,{query:e,...r,headers:T([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,r){return this._client.delete(w`/vector_stores/${e}`,{...r,headers:T([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}search(e,r,n){return this._client.getAPIList(w`/vector_stores/${e}/search`,ir,{body:r,method:"post",...n,headers:T([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};kr.Files=ss;kr.FileBatches=as;var di=class extends E{create(e,r){return this._client.post("/videos",vg({body:e,...r},this._client))}retrieve(e,r){return this._client.get(w`/videos/${e}`,r)}list(e={},r){return this._client.getAPIList("/videos",xr,{query:e,...r})}delete(e,r){return this._client.delete(w`/videos/${e}`,r)}downloadContent(e,r={},n){return this._client.get(w`/videos/${e}/content`,{query:r,...n,headers:T([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}remix(e,r,n){return this._client.post(w`/videos/${e}/remix`,vg({body:r,...n},this._client))}};var os,SE,Du,fi=class extends E{constructor(){super(...arguments),os.add(this)}async unwrap(e,r,n=this._client.webhookSecret,i=300){return await this.verifySignature(e,r,n,i),JSON.parse(e)}async verifySignature(e,r,n=this._client.webhookSecret,i=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");x(this,os,"m",SE).call(this,n);let a=T([r]).values,s=x(this,os,"m",Du).call(this,a,"webhook-signature"),o=x(this,os,"m",Du).call(this,a,"webhook-timestamp"),l=x(this,os,"m",Du).call(this,a,"webhook-id"),c=parseInt(o,10);if(isNaN(c))throw new er("Invalid webhook timestamp format");let u=Math.floor(Date.now()/1e3);if(u-c>i)throw new er("Webhook timestamp is too old");if(c>u+i)throw new er("Webhook timestamp is too new");let p=s.split(" ").map(g=>g.startsWith("v1,")?g.substring(3):g),d=n.startsWith("whsec_")?Buffer.from(n.replace("whsec_",""),"base64"):Buffer.from(n,"utf-8"),f=l?`${l}.${o}.${e}`:`${o}.${e}`,h=await crypto.subtle.importKey("raw",d,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let g of p)try{let b=Buffer.from(g,"base64");if(await crypto.subtle.verify("HMAC",h,b,new TextEncoder().encode(f)))return}catch{continue}throw new er("The given webhook signature does not match the expected signature")}};os=new WeakSet,SE=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},Du=function(e,r){if(!e)throw new Error("Headers are required");let n=e.get(r);if(n==null)throw new Error(`Missing required header: ${r}`);return n};var $g,Mg,Lu,EE,V=class{constructor({baseURL:e=en("OPENAI_BASE_URL"),apiKey:r=en("OPENAI_API_KEY"),organization:n=en("OPENAI_ORG_ID")??null,project:i=en("OPENAI_PROJECT_ID")??null,webhookSecret:a=en("OPENAI_WEBHOOK_SECRET")??null,...s}={}){if($g.add(this),Lu.set(this,void 0),this.completions=new ti(this),this.chat=new Xr(this),this.embeddings=new ni(this),this.files=new ai(this),this.images=new li(this),this.audio=new ar(this),this.moderations=new pi(this),this.models=new ui(this),this.fineTuning=new Lt(this),this.graders=new sn(this),this.vectorStores=new kr(this),this.webhooks=new fi(this),this.beta=new Dt(this),this.batches=new Jn(this),this.uploads=new cn(this),this.responses=new Ar(this),this.realtime=new Er(this),this.conversations=new nn(this),this.evals=new an(this),this.containers=new rn(this),this.videos=new di(this),r===void 0)throw new q("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");let o={apiKey:r,organization:n,project:i,webhookSecret:a,...s,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&O4())throw new q(`It looks like you're running in a browser-like environment.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
q [Error]: Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.
    at new V (/opt/render/project/src/dist/index.cjs:83:44267)
    at Object.<anonymous> (/opt/render/project/src/dist/index.cjs:92:8552)
    at Module._compile (node:internal/modules/cjs/loader:1730:14)
    at Object..js (node:internal/modules/cjs/loader:1895:10)
    at Module.load (node:internal/modules/cjs/loader:1465:32)
    at Function._load (node:internal/modules/cjs/loader:1282:12)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:235:24)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:171:5)
    at node:internal/main/run_main_module:36:49
Node.js v22.16.0